---
import Layout from '@layouts/Layout.astro'
import { getSortedPosts, url } from '@utils'
import { getCollection, render } from 'astro:content'
import PostPreview from '@components/PostPreview.astro'
import Pagination from '@components/Pagination.astro'
import BlockHeader from '@components/BlockHeader.astro'
import HomeBanner from '@components/HomeBanner.astro'
import siteConfig from '../site.config'

const homeHeaderCollection = await getCollection('homeHeader')
const homeBodyCollection = await getCollection('homeBody')
let homeHeader
let homeBody
let HomeHeaderContent
let HomeBodyContent

if (homeHeaderCollection.length > 0) {
  homeHeader = homeHeaderCollection[0]
  const { Content } = await render(homeHeader)
  HomeHeaderContent = Content
}

if (homeBodyCollection.length > 0) {
  homeBody = homeBodyCollection[0]
  const { Content } = await render(homeBody)
  HomeBodyContent = Content
}
const articles = (await getSortedPosts('articles')).slice(0, 3)
const writeups = (await getSortedPosts('writeups')).slice(0, 3)
---

<Layout>
  {
    HomeHeaderContent && homeHeader && (
      <HomeBanner avatarImage={homeHeader.data.avatarImage}>
        <HomeHeaderContent />
      </HomeBanner>
    )
  }
  {
    HomeBodyContent && homeBody && (
      <HomeBanner githubCalendar={homeBody.data.githubCalendar}>
        <HomeBodyContent />
      </HomeBanner>
    )
  }
  <BlockHeader>üìù Latest Articles</BlockHeader>
  {articles.map((article) => <PostPreview post={article} />)}
  <Pagination nextLink={url('articles')} nextText="All Articles" />
  <BlockHeader>‚õ≥Ô∏è Latest Writeups</BlockHeader>
  {writeups.map((writeup) => <PostPreview post={writeup} />)}
  <Pagination nextLink={url('writeups')} nextText="All Writeups" />
</Layout>

<style is:global>
  a.heading-anchor {
    display: none !important;
  }
</style>
